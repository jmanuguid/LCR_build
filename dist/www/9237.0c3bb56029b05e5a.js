"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9237],{9237:(P,c,s)=>{s.r(c),s.d(c,{AddUserPageModule:()=>N});var m=s(9808),o=s(2382),f=s(8058),d=s(7614),p=s(655),e=s(4893),g=s(4465),h=s(8876);function v(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"Username must be at least 6 characters length"),e.qZA())}function b(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"Password must be at least 8 characters length"),e.qZA())}function A(r,n){if(1&r&&(e.TgZ(0,"div",38)(1,"label",29),e._UZ(2,"input",39),e.TgZ(3,"span"),e._uU(4),e.qZA()()()),2&r){const t=e.oxw().$implicit;e.Q6J("formGroup",t),e.xp6(2),e.Q6J("value",t.controls.value.value),e.xp6(2),e.Oqu(t.controls.label.value)}}function Z(r,n){if(1&r&&(e.ynx(0),e.YNc(1,A,5,3,"div",37),e.BQk()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf","admin"!==t.value.value)}}function x(r,n){if(1&r&&(e.TgZ(0,"div",35),e.YNc(1,Z,2,1,"ng-container",36),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.userForm.controls.roles.controls)}}function U(r,n){1&r&&(e.TgZ(0,"div",40),e._uU(1,"* Must select at least one"),e.qZA())}function T(r,n){1&r&&e._uU(0,"This field is invalid")}const y=[{path:"",component:(()=>{class r{constructor(t,a,l,i){this.fb=t,this.toast=a,this.router=l,this.sqlService=i,this.userForm=this.fb.nonNullable.group({firstName:this.fb.nonNullable.control("",{validators:o.kI.required}),lastName:this.fb.nonNullable.control("",{validators:o.kI.required}),username:this.fb.nonNullable.control("",{validators:[o.kI.required,o.kI.minLength(6)]}),password:this.fb.nonNullable.control("",{validators:[o.kI.required,o.kI.minLength(8)]}),roles:this.fb.array([{label:"Admin",value:"admin"},{label:"Birth admin",value:"birth-admin"},{label:"Birth viewer",value:"birth-viewer"},{label:"Death admin",value:"death-admin"},{label:"Death viewer",value:"death-viewer"},{label:"Marriage admin",value:"marriage-admin"},{label:"Marriage viewer",value:"marriage-viewer"},{label:"User admin",value:"user-admin"},{label:"Audit logs admin",value:"audit-logs-admin"}].map(u=>this.fb.group({label:this.fb.nonNullable.control(u.label),value:this.fb.nonNullable.control(u.value),checked:this.fb.nonNullable.control(!1)})),{validators:u=>u.value.some(F=>F.checked)?null:{code:"must-select-at-least-once"}})}),this.loading=!1}ngOnInit(){}onSubmit(){return(0,p.mG)(this,void 0,void 0,function*(){if(this.userForm.invalid)return this.userForm.markAsDirty(),this.userForm.markAllAsTouched(),void this.userForm.updateValueAndValidity();this.loading=!0;try{const t=this.userForm.getRawValue(),a=Object.assign(Object.assign({},t),{roles:t.roles.filter(i=>i.checked).map(i=>i.value)}),l=yield this.sqlService.table("user").add(a);this.router.navigate(["/admin/users",l.id]),this.loading=!1}catch(t){this.loading=!1,this.toast.presentError(t)}})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(o.qu),e.Y36(g.k),e.Y36(d.F0),e.Y36(h.a))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-user"]],decls:59,vars:9,consts:[[1,"bg-info","border-bottom"],[1,"px-xl-5","px-4"],[1,"d-flex","flex-wrap","align-items-center","px-xl-5","pt-5"],["href","/",1,"d-flex","align-items-center","mb-0","me-auto","text-dark","text-decoration-none","lh-1"],[1,"fs-2-large","text-primary","fw-bold","text-light"],[1,"px-xl-5","pt-3","pb-3","d-flex","justify-content-between","align-items-start"],["type","button","routerLink","../",1,"btn","btn-sm","btn-link","text-white","d-flex","align-items-center","text-decoration-none","text-info","ps-0"],[1,"material-icons","fs-3","me-2"],[1,"fs-5"],[1,"px-xl-5","px-4","pb-5"],["novalidate","",1,"px-xl-5","mt-5",3,"formGroup"],[1,"row","g-3"],[1,"col-12"],["for","firstName",1,"form-label","fs-5","mb-1"],["type","text","formControlName","firstName",1,"form-control","py-2","rounded-3"],[1,"invalid-feedback","mt-1","fs-5"],["for","lastName",1,"form-label","fs-5","mb-1"],["type","text","formControlName","lastName",1,"form-control","py-2","rounded-3"],["for","username",1,"form-label","fs-5","mb-1"],["type","text","formControlName","username","autocomplete","email",1,"form-control","py-2","rounded-3"],["for","firstName",1,"form-label","fs-5-small","mt-1","mb-0"],[4,"ngIf","ngIfElse"],["for","username","fs-5-small","",1,"form-label","fs-5","mb-1"],[1,"input-group","has-validation"],["type","password","formControlName","password","autocomplete","current-password",1,"form-control","py-2","rounded-3"],[1,"mt-5"],[1,"container","mx-0"],[1,"row","my-4","py-2"],[1,"col-6","p-0","py-1"],[1,"list-group-item","d-flex","gap-2"],["type","checkbox","checked","",1,"form-check-input","flex-shrink-0",3,"formControl"],["class","row","formArrayName","roles",4,"ngIf"],["class","invalid-feedback mt-3 fs-5",4,"ngIf"],["type","submit",1,"rounded-3","px-4","py-2","btn","btn-info","mt-5",3,"disabled","click"],["defaultErrorLabelState",""],["formArrayName","roles",1,"row"],[4,"ngFor","ngForOf"],["class","col-6 p-0 py-1",3,"formGroup",4,"ngIf"],[1,"col-6","p-0","py-1",3,"formGroup"],["formControlName","checked","type","checkbox","checked","",1,"form-check-input","flex-shrink-0",3,"value"],[1,"invalid-feedback","mt-3","fs-5"]],template:function(t,a){if(1&t&&(e.TgZ(0,"header",0)(1,"div",1)(2,"section",2)(3,"a",3)(4,"span",4),e._uU(5,"Add user"),e.qZA()()(),e.TgZ(6,"section",5)(7,"button",6)(8,"span",7),e._uU(9,"arrow_back"),e.qZA(),e.TgZ(10,"span",8),e._uU(11,"Back"),e.qZA()()()()(),e.TgZ(12,"main",9)(13,"form",10)(14,"div",11)(15,"div",12)(16,"label",13),e._uU(17,"First name"),e.qZA(),e._UZ(18,"input",14),e.TgZ(19,"div",15),e._uU(20,"This field is required"),e.qZA()(),e.TgZ(21,"div",12)(22,"label",16),e._uU(23,"Last name"),e.qZA(),e._UZ(24,"input",17),e.TgZ(25,"div",15),e._uU(26,"This field is required"),e.qZA()(),e.TgZ(27,"div",12)(28,"label",18),e._uU(29,"Username"),e.qZA(),e._UZ(30,"input",19),e.TgZ(31,"label",20),e._uU(32,"This cannot be changed later"),e.qZA(),e.TgZ(33,"div",15),e.YNc(34,v,2,0,"span",21),e.qZA()(),e.TgZ(35,"div",12)(36,"label",22),e._uU(37,"Password"),e.qZA(),e.TgZ(38,"div",23),e._UZ(39,"input",24),e.TgZ(40,"div",15),e.YNc(41,b,2,0,"span",21),e.qZA()()()(),e.TgZ(42,"div")(43,"h4",25)(44,"strong"),e._uU(45,"Assign permissions"),e.qZA()(),e.TgZ(46,"div",26)(47,"div",27)(48,"div",28)(49,"label",29),e._UZ(50,"input",30),e.TgZ(51,"span"),e._uU(52,"Admin"),e.qZA()()()(),e.YNc(53,x,2,1,"div",31),e.qZA(),e.YNc(54,U,2,0,"div",32),e.qZA(),e.TgZ(55,"button",33),e.NdJ("click",function(){return a.onSubmit()}),e._uU(56,"Create user"),e.qZA()()(),e.YNc(57,T,1,0,"ng-template",null,34,e.W1O)),2&t){const l=e.MAs(58);e.xp6(13),e.Q6J("formGroup",a.userForm),e.xp6(21),e.Q6J("ngIf",a.userForm.controls.username.errors&&a.userForm.controls.username.errors.minlength)("ngIfElse",l),e.xp6(7),e.Q6J("ngIf",a.userForm.controls.password.errors&&a.userForm.controls.password.errors.minlength)("ngIfElse",l),e.xp6(9),e.Q6J("formControl",a.userForm.controls.roles.controls[0].controls.checked),e.xp6(3),e.Q6J("ngIf",!a.userForm.controls.roles.controls[0].value.checked),e.xp6(1),e.Q6J("ngIf",a.userForm.controls.roles.touched&&a.userForm.controls.roles.invalid),e.xp6(1),e.Q6J("disabled",a.loading)}},dependencies:[m.sg,m.O5,o._Y,o.Fj,o.Wl,o.JJ,o.JL,o.oH,o.sg,o.u,o.CE,f.YI,d.rH],styles:["form[_ngcontent-%COMP%]{max-width:500px}input[_ngcontent-%COMP%]:not([type=checkbox]){min-height:48px}"]}),r})()}];let k=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[d.Bz.forChild(y),d.Bz]}),r})(),N=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[m.ez,o.u5,o.UX,f.Pc,k]}),r})()}}]);
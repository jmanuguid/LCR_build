"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4834],{4834:(U,p,s)=>{s.r(p),s.d(p,{ViewUserPageModule:()=>S});var c=s(9808),l=s(2382),g=s(8058),m=s(7614),i=s(655),e=s(4893),u=s(8876),f=s(4465),Z=s(3500),w=s(5219),y=s(7556);function T(r,a){if(1&r&&(e.TgZ(0,"span",4),e._uU(1),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.hij("\xa0-\xa0",t.user.username,"")}}function A(r,a){1&r&&(e.TgZ(0,"button",16)(1,"span"),e._uU(2,"Edit profile"),e.qZA(),e.TgZ(3,"span",17),e._uU(4,"edit"),e.qZA()())}function V(r,a){if(1&r&&(e.TgZ(0,"div",18)(1,"a",19)(2,"div",20)(3,"div")(4,"h6",21),e._uU(5,"First name"),e.qZA(),e.TgZ(6,"p",22),e._uU(7),e.qZA()()()(),e.TgZ(8,"a",19)(9,"div",20)(10,"div")(11,"h6",21),e._uU(12,"Last name"),e.qZA(),e.TgZ(13,"p",22),e._uU(14),e.qZA()()()(),e.TgZ(15,"a",19)(16,"div",20)(17,"div")(18,"h6",21),e._uU(19,"Username"),e.qZA(),e.TgZ(20,"p",22),e._uU(21),e.qZA()()()()()),2&r){const t=e.oxw();e.xp6(7),e.Oqu(t.user.firstName),e.xp6(7),e.Oqu(t.user.lastName),e.xp6(7),e.Oqu(t.user.username)}}function C(r,a){if(1&r){const t=e.EpF();e.TgZ(0,"div",39),e.NdJ("change",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onSubmit())}),e.TgZ(1,"label",28),e._UZ(2,"input",40),e.TgZ(3,"span"),e._uU(4),e.qZA()()()}if(2&r){const t=a.$implicit;e.Q6J("formGroup",t),e.xp6(2),e.Q6J("value",t.controls.value.value),e.xp6(2),e.Oqu(t.controls.label.value)}}function F(r,a){if(1&r&&(e.TgZ(0,"div",37),e.YNc(1,C,5,3,"div",38),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.userForm.controls.roles.controls)}}function P(r,a){if(1&r){const t=e.EpF();e.TgZ(0,"div",41)(1,"p"),e._uU(2,"Are you sure you want to delete user?"),e.qZA(),e.TgZ(3,"div",42)(4,"button",43),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.confirmDeleteModal&&o.confirmDeleteModal.hide())}),e._uU(5,"No"),e.qZA(),e.TgZ(6,"button",43),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.deleteUser())}),e._uU(7,"Yes, delete"),e.qZA()()()}}function k(r,a){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"form",23),e._UZ(2,"hr",24),e.TgZ(3,"div")(4,"h4")(5,"strong"),e._uU(6,"Permissions"),e.qZA()(),e.TgZ(7,"div",25)(8,"div",26)(9,"div",27),e.NdJ("change",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.superuserChange())}),e.TgZ(10,"label",28),e._UZ(11,"input",29),e.TgZ(12,"span"),e._uU(13,"Admin"),e.qZA()()()(),e.YNc(14,F,2,1,"div",30),e.qZA()()(),e._UZ(15,"hr",31),e.TgZ(16,"div")(17,"h4")(18,"strong"),e._uU(19,"Password"),e.qZA()(),e.TgZ(20,"a",32)(21,"div",20)(22,"div")(23,"p",22),e._uU(24,"Change user password"),e.qZA()()()(),e.TgZ(25,"button",33)(26,"span"),e._uU(27,"Change password"),e.qZA()()(),e._UZ(28,"hr",34),e.TgZ(29,"div")(30,"a",32)(31,"div",20)(32,"div")(33,"p",21)(34,"strong"),e._uU(35,"DELETE ACCOUNT"),e.qZA()()()()(),e.TgZ(36,"button",35),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(40),d=e.oxw();return e.KtG(d.openModal(o))}),e.TgZ(37,"span"),e._uU(38,"Delete account"),e.qZA()(),e.YNc(39,P,8,0,"ng-template",null,36,e.W1O),e.qZA(),e.BQk()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.userForm),e.xp6(10),e.Q6J("formControl",t.superuserFormControl),e.xp6(3),e.Q6J("ngIf",!t.superuserFormControl.value)}}function q(r,a){1&r&&e._uU(0,"Loading...")}const M=[{path:"",component:(()=>{class r{constructor(t,n,o,d,h,v,x,I){this.activatedRoute=t,this.sqlService=n,this.toast=o,this.modalService=d,this.loading=h,this.router=v,this.fb=x,this.authService=I,this.userForm=this.fb.group({roles:this.fb.array([{label:"Birth admin",value:"birth-admin"},{label:"Birth viewer",value:"birth-viewer"},{label:"Death admin",value:"death-admin"},{label:"Death viewer",value:"death-viewer"},{label:"Marriage admin",value:"marriage-admin"},{label:"Marriage viewer",value:"marriage-viewer"},{label:"User admin",value:"user-admin"},{label:"Audit logs admin",value:"audit-logs-admin"}].map(_=>this.fb.group({label:this.fb.nonNullable.control(_.label),value:this.fb.nonNullable.control(_.value),checked:this.fb.nonNullable.control(!1)})))}),this.superuserFormControl=this.fb.nonNullable.control(!1),this.userAdmin=!1}ngOnInit(){this.initializeCurrentUser(),this.initializeUser()}initializeCurrentUser(){var t;return(0,i.mG)(this,void 0,void 0,function*(){try{const n=yield this.authService.getCurrentUserSnapshot();if(null===n)throw{code:"unauthenticated",message:"User is not currently logged in"};const o=null!==(t=n.roles)&&void 0!==t?t:[];this.userAdmin=o.includes("admin")||o.includes("user-admin")}catch(n){console.error(n)}})}initializeUser(){return(0,i.mG)(this,void 0,void 0,function*(){try{const t=this.activatedRoute.snapshot.params.id,n=yield this.sqlService.table("user").row(t).get();this.user=n,this.userForm.controls.roles.controls.forEach(o=>{!o.value.value||o.controls.checked.setValue(n.roles.includes(o.value.value))}),this.superuserFormControl.setValue(n.roles.includes("admin"))}catch(t){this.toast.presentError(t)}})}onSubmit(){return(0,i.mG)(this,void 0,void 0,function*(){if(this.userForm.invalid)return this.userForm.markAsDirty(),this.userForm.markAllAsTouched(),void this.userForm.updateValueAndValidity();try{const n={roles:this.userForm.getRawValue().roles.filter(d=>d.checked).map(d=>d.value)},o=this.activatedRoute.snapshot.params.id;yield this.sqlService.table("user").row(o).update(n)}catch(t){this.toast.presentError(t)}})}superuserChange(){return(0,i.mG)(this,void 0,void 0,function*(){try{const n=this.superuserFormControl.getRawValue(),o=this.activatedRoute.snapshot.params.id,d=yield this.sqlService.table("user").row(o),h=yield d.get();if(!h)throw"Sorry, this user cannot be found or has already been deleted";const v=h.roles;if(n)var t=v.concat("admin");else t=v.filter(b=>"admin"!==b);const x={roles:t};yield d.update(x)}catch(n){this.toast.presentError(n)}})}openModal(t){this.confirmDeleteModal=this.modalService.show(t,{class:"modal-sm"})}deleteUser(){return(0,i.mG)(this,void 0,void 0,function*(){this.confirmDeleteModal&&this.confirmDeleteModal.hide();const t=this.loading.create();try{const n=this.activatedRoute.snapshot.params.id;yield this.sqlService.table("user").row(n).delete(),yield this.router.navigate(["../"],{relativeTo:this.activatedRoute}),t.hide()}catch(n){yield t.hide(),this.toast.presentError(n)}})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(m.gz),e.Y36(u.a),e.Y36(f.k),e.Y36(Z.tT),e.Y36(w.b),e.Y36(m.F0),e.Y36(l.qu),e.Y36(y.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-view-user"]],decls:20,vars:5,consts:[[1,"bg-info","border-bottom"],[1,"px-xl-5","px-4"],[1,"d-flex","flex-wrap","align-items-center","px-xl-5","pt-5"],["href","/",1,"d-flex","align-items-center","mb-0","me-auto","text-dark","text-decoration-none","lh-1"],[1,"fs-2-large","text-primary","fw-bold","text-light"],["class","fs-2-large text-primary  fw-bold text-light",4,"ngIf"],["type","button","class","btn btn-sm btn-default d-flex align-items-center text-decoration-none px-4 py-2 rounded-3 fs-5 pe-0 text-light","routerLink","edit",4,"ngIf"],[1,"px-xl-5","pt-3","pb-3","d-flex","justify-content-between","align-items-start"],["type","button","routerLink","../",1,"btn","btn-sm","btn-link","d-flex","align-items-center","text-decoration-none","text-info","ps-0","text-light"],[1,"material-icons","fs-3","me-2"],[1,"fs-5"],[1,"px-xl-5","pb-5"],[1,"px-xl-5","px-4","pb-5"],["class","mt-4",4,"ngIf","ngIfElse"],[4,"ngIf"],["loadingState",""],["type","button","routerLink","edit",1,"btn","btn-sm","btn-default","d-flex","align-items-center","text-decoration-none","px-4","py-2","rounded-3","fs-5","pe-0","text-light"],[1,"material-icons","fs-3","ms-2"],[1,"mt-4"],["aria-current","true",1,"list-group-item","list-group-item-action","d-flex","gap-3","py-3"],[1,"d-flex","gap-2","w-100","justify-content-between"],[1,"mb-0"],[1,"mb-0","opacity-75"],[3,"formGroup"],[1,"mt-4","mb-5"],[1,"container","mx-0"],[1,"row","my-4","py-2"],[1,"col-6","p-0","py-1",3,"change"],[1,"list-group-item","d-flex","gap-2"],["type","checkbox","checked","",1,"form-check-input","flex-shrink-0",3,"formControl"],["class","row","formArrayName","roles",4,"ngIf"],[1,"mt-5","mb-5"],["role","button","aria-current","true",1,"list-group-item","list-group-item-action","d-flex","gap-3","py-3"],["type","button","routerLink","change-password",1,"mt-2","btn","btn-sm","btn-info","d-flex","align-items-center","text-decoration-none","px-4","py-2","rounded-3","fs-5"],[1,"mt-5","mb-4"],["type","button",1,"mt-2","btn","btn-sm","btn-danger","d-flex","align-items-center","text-decoration-none","px-4","py-2","rounded-3","fs-5",3,"click"],["template",""],["formArrayName","roles",1,"row"],["class","col-6 p-0 py-1",3,"formGroup","change",4,"ngFor","ngForOf"],[1,"col-6","p-0","py-1",3,"formGroup","change"],["formControlName","checked","type","checkbox","checked","",1,"form-check-input","flex-shrink-0",3,"value"],[1,"modal-body","text-center","rounded-4"],[1,"d-flex"],["type","button",1,"flex-grow-1","btn","btn-default",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"header",0)(1,"div",1)(2,"section",2)(3,"a",3)(4,"span",4),e._uU(5,"User"),e.qZA(),e.YNc(6,T,2,1,"span",5),e.qZA(),e.YNc(7,A,5,0,"button",6),e.qZA(),e.TgZ(8,"section",7)(9,"button",8)(10,"span",9),e._uU(11,"arrow_back"),e.qZA(),e.TgZ(12,"span",10),e._uU(13,"Back"),e.qZA()()()()(),e.TgZ(14,"main",11)(15,"main",12),e.YNc(16,V,22,3,"div",13),e.YNc(17,k,41,3,"ng-container",14),e.qZA()(),e.YNc(18,q,1,0,"ng-template",null,15,e.W1O)),2&t){const o=e.MAs(19);e.xp6(6),e.Q6J("ngIf",n.user),e.xp6(1),e.Q6J("ngIf",n.userAdmin),e.xp6(9),e.Q6J("ngIf",n.user)("ngIfElse",o),e.xp6(1),e.Q6J("ngIf",n.userAdmin)}},dependencies:[c.sg,c.O5,l._Y,l.Wl,l.JJ,l.JL,l.oH,l.sg,l.u,l.CE,g.YI,m.rH]}),r})()}];let N=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[m.Bz.forChild(M),m.Bz]}),r})(),S=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[c.ez,l.u5,l.UX,g.Pc,N]}),r})()},5219:(U,p,s)=>{s.d(p,{b:()=>m});var c=s(4893);let l=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(u){return new(u||i)},i.\u0275cmp=c.Xpm({type:i,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"p-3","loading-dots"]],template:function(u,f){1&u&&(c.TgZ(0,"div",0),c._uU(1,"Please wait"),c.qZA())}}),i})();var g=s(3500);let m=(()=>{class i{constructor(u){this.modalService=u}create(){const u=this.modalService.show(l,{class:"modal-sm",backdrop:"static",keyboard:!1,animated:!1});return Object.assign(Object.assign({},u),{hide:()=>new Promise(f=>{setTimeout(()=>{u.hide(),f()},300)})})}}return i.\u0275fac=function(u){return new(u||i)(c.LFG(g.tT))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()}}]);
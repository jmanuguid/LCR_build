"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5103],{5103:(A,C,o)=>{o.r(C),o.d(C,{UsersPageModule:()=>z});var h=o(9808),a=o(2382),y=o(8058),m=o(7614),g=o(1735),d=o(1065),t=o(4893),l=o(655),c=o(7556);function v(n,r){1&n&&(t.TgZ(0,"button",8)(1,"span"),t._uU(2,"Add user"),t.qZA()())}let x=(()=>{class n{constructor(e){this.authService=e,this.userAdmin=!1}ngOnInit(){this.initializeCurrentUser()}initializeCurrentUser(){var e;return(0,l.mG)(this,void 0,void 0,function*(){try{const s=yield this.authService.getCurrentUserSnapshot();if(null===s)throw{code:"unauthenticated",message:"User is not currently logged in"};const i=null!==(e=s.roles)&&void 0!==e?e:[];this.userAdmin=i.includes("admin")||i.includes("marriage-admin")}catch(s){console.error(s)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-header"]],decls:10,vars:1,consts:[[1,"bg-info","border-bottom"],[1,"wrapper","px-xl-5","px-4"],[1,"d-flex","flex-wrap","align-items-center","px-xl-5","pt-5"],[1,"d-flex","align-items-center","mb-0","me-auto","text-dark","text-decoration-none","lh-1"],[1,"fs-2-large","text-primary","fw-bold","text-light"],["type","button","class","btn btn-sm btn-light d-flex align-items-center text-decoration-none px-4 py-2 rounded-3 fs-5","routerLink","new",4,"ngIf"],[1,"px-xl-5","pt-3","pb-3","d-flex","justify-content-between","align-items-start"],[1,"text-white-50"],["type","button","routerLink","new",1,"btn","btn-sm","btn-light","d-flex","align-items-center","text-decoration-none","px-4","py-2","rounded-3","fs-5"]],template:function(e,s){1&e&&(t.TgZ(0,"header",0)(1,"div",1)(2,"section",2)(3,"a",3)(4,"span",4),t._uU(5,"Users"),t.qZA()(),t.YNc(6,v,3,0,"button",5),t.qZA(),t.TgZ(7,"section",6)(8,"span",7),t._uU(9,"Manage users and access"),t.qZA()()()()),2&e&&(t.xp6(6),t.Q6J("ngIf",s.userAdmin))},dependencies:[h.O5,y.YI,m.rH]}),n})();var b=o(8372),P=o(8505),u=o(3905),U=o(7391),O=o(8876),M=o(4465);function N(n,r){if(1&n&&(t.TgZ(0,"a",21)(1,"div",22)(2,"div",23)(3,"span",24),t._uU(4,"person"),t.qZA()(),t.TgZ(5,"div")(6,"div",25)(7,"b",26),t._uU(8),t.qZA()(),t.TgZ(9,"div",27),t._uU(10),t.qZA()()()()),2&n){const e=r.$implicit;t.Q6J("routerLink",e.id),t.xp6(8),t.AsE("",e.firstName," ",e.lastName,""),t.xp6(2),t.Oqu(e.username)}}function E(n,r){if(1&n&&(t.ynx(0),t.YNc(1,N,11,4,"a",20),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.records)}}function S(n,r){1&n&&t._uU(0,"Please wait...")}let J=(()=>{class n{constructor(e,s,i,f,p){this.sqlService=e,this.toast=s,this.activatedRoute=i,this.router=f,this.fb=p,this.searchControl=this.fb.nonNullable.control(""),this.hasNext=!1,this.hasPrevious=!1,this.fetching=!1}ngOnInit(){this.initializeSearchControl(),this.initializeQueryParams()}ngOnDestroy(){U.c.unsubscribe(this.searchControlSubscription,this.queryParamsSubscription)}initializeSearchControl(){this.searchControlSubscription=this.searchControl.valueChanges.pipe((0,b.b)(1e3),(0,P.b)(e=>{this.router.navigate([],{queryParams:{search:e||void 0},queryParamsHandling:"merge"})})).subscribe()}initializeQueryParams(){this.activatedRoute.queryParams.pipe((0,P.b)(e=>{e.search?this.searchRecords():this.initializeRecords()})).subscribe()}initializeRecords(){return(0,l.mG)(this,void 0,void 0,function*(){this.fetching=!0;try{const e=yield(0,u.z)(this.activatedRoute.queryParams),s=e.limit,i=s?Number(s):10,f=e.offset,Z=(f?Number(f):0)*i,T=yield this.sqlService.table("user").ref.limit(i+1).offset(Z).get();this.records=T.filter((L,q)=>q<i),this.hasNext=T.length>i,this.hasPrevious=Z>0,this.fetching=!1}catch(e){this.fetching=!1,this.toast.presentError(e)}})}searchRecords(){return(0,l.mG)(this,void 0,void 0,function*(){this.fetching=!0;try{const s=(yield(0,u.z)(this.activatedRoute.queryParams)).search,i=yield this.sqlService.table("user").ref.search(s).get();this.fetching=!1,this.records=i}catch(e){this.fetching=!1,this.toast.presentError(e)}})}onLimitOptionChange(e){this.router.navigate([],{queryParams:{limit:e}}),this.limit=null!=e?e:"10"}next(){return(0,l.mG)(this,void 0,void 0,function*(){const s=(yield(0,u.z)(this.activatedRoute.queryParams)).offset,f=(s?Number(s):0)+1,p=Math.max(0,f);this.router.navigate([],{queryParams:{offset:p},queryParamsHandling:"merge"})})}previous(){return(0,l.mG)(this,void 0,void 0,function*(){const s=(yield(0,u.z)(this.activatedRoute.queryParams)).offset,f=(s?Number(s):0)-1,p=Math.max(0,f);this.router.navigate([],{queryParams:{offset:0===p?void 0:p},queryParamsHandling:"merge"})})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(O.a),t.Y36(M.k),t.Y36(m.gz),t.Y36(m.F0),t.Y36(a.qu))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-content"]],decls:44,vars:7,consts:[[1,"px-xl-5","mt-5"],[1,"px-xl-5","px-4"],[1,"d-flex","align-items-center","flex-column","flex-xl-row","gap-xl-4","mb-3"],["role","search",1,"flex-grow-1","w-100"],["type","search","placeholder","Search...","aria-label","Search",1,"form-control","bg-light",3,"formControl"],[1,"ms-auto","d-flex","align-items-center","gap-3"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","d-flex","align-items-center","border-0","pe-0"],[1,"fs-5",3,"ngSwitch"],[1,"text-secondary","me-2","fw-light"],[1,"material-icons"],[1,"dropdown-menu","rounded-4","bg-white","shadow"],[1,"px-3","pb-2","m-0","mb-2","fs-5-small","text-secondary"],["role","button",1,"dropdown-item",3,"click"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-center","gap-3","mt-5"],["type","button",1,"btn","btn-sm","d-flex","align-items-center","border-0","text-decoration-none","text-info","ps-0",3,"disabled","click"],[1,"material-icons","fs-3","me-2"],[1,"fs-5"],["loadingState",""],["class","list-group-item list-group-item-action active py-3 lh-sm rounded-3","aria-current","true",3,"routerLink",4,"ngFor","ngForOf"],["aria-current","true",1,"list-group-item","list-group-item-action","active","py-3","lh-sm","rounded-3",3,"routerLink"],[1,"d-flex","align-items-center"],[1,"thumbnail","bg-primary","text-light","rounded-4","d-flex","me-3"],[1,"material-icons","m-auto"],[1,"d-flex","w-100","align-items-center","justify-content-between"],[1,"mb-1","fw-normal"],[1,"col-10","mb-1","small"]],template:function(e,s){if(1&e&&(t.TgZ(0,"main",0)(1,"main",1)(2,"header",2)(3,"form",3),t._UZ(4,"input",4),t.qZA(),t.TgZ(5,"aside",5)(6,"div",6)(7,"button",7)(8,"span",8)(9,"span",9),t._uU(10,"Items per page:"),t.qZA(),t.TgZ(11,"span"),t._uU(12),t.qZA()(),t.TgZ(13,"span",10),t._uU(14,"arrow_drop_down"),t.qZA()(),t.TgZ(15,"ul",11)(16,"p",12),t._uU(17,"Limit"),t.qZA(),t.TgZ(18,"li")(19,"a",13),t.NdJ("click",function(){return s.onLimitOptionChange()}),t._uU(20,"10"),t.qZA()(),t.TgZ(21,"li")(22,"a",13),t.NdJ("click",function(){return s.onLimitOptionChange("20")}),t._uU(23,"20"),t.qZA()(),t.TgZ(24,"li")(25,"a",13),t.NdJ("click",function(){return s.onLimitOptionChange("50")}),t._uU(26,"50"),t.qZA()(),t.TgZ(27,"li")(28,"a",13),t.NdJ("click",function(){return s.onLimitOptionChange("100")}),t._uU(29,"100"),t.qZA()()()()()(),t.YNc(30,E,2,1,"ng-container",14),t.TgZ(31,"div",15)(32,"button",16),t.NdJ("click",function(){return s.previous()}),t.TgZ(33,"span",17),t._uU(34,"arrow_back"),t.qZA(),t.TgZ(35,"span",18),t._uU(36,"Previous"),t.qZA()(),t.TgZ(37,"button",16),t.NdJ("click",function(){return s.next()}),t.TgZ(38,"span",18),t._uU(39,"Next"),t.qZA(),t.TgZ(40,"span",17),t._uU(41,"arrow_forward"),t.qZA()()(),t.YNc(42,S,1,0,"ng-template",null,19,t.W1O),t.qZA()()),2&e){const i=t.MAs(43);t.xp6(4),t.Q6J("formControl",s.searchControl),t.xp6(4),t.Q6J("ngSwitch",s.searchBy),t.xp6(4),t.Oqu(s.limit||10),t.xp6(18),t.Q6J("ngIf",s.records)("ngIfElse",i),t.xp6(2),t.Q6J("disabled",s.fetching||!s.hasPrevious),t.xp6(5),t.Q6J("disabled",s.fetching||!s.hasNext)}},dependencies:[h.sg,h.O5,h.RF,a._Y,a.Fj,a.JJ,a.JL,a.F,a.oH,y.Fo,m.yS],styles:[".thumbnail[_ngcontent-%COMP%]{width:40px;height:40px}button[_ngcontent-%COMP%]:disabled{color:var(--bs-secondary)!important}.list-group-item[_ngcontent-%COMP%]:hover{background:var(--bs-light)}"]}),n})();const w=[{path:"",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-users"]],decls:2,vars:0,template:function(e,s){1&e&&t._UZ(0,"app-header")(1,"app-content")},dependencies:[x,J]}),n})(),canActivate:[d.E]},{path:"new",loadChildren:()=>o.e(9237).then(o.bind(o,9237)).then(n=>n.AddUserPageModule),canActivate:[g.p,d.E],data:{roleContains:["admin","user-viewer","user-admin"]}},{path:":id",loadChildren:()=>o.e(4834).then(o.bind(o,4834)).then(n=>n.ViewUserPageModule),canActivate:[d.E]},{path:":id/edit",loadChildren:()=>o.e(9872).then(o.bind(o,9872)).then(n=>n.EditUserPageModule),canActivate:[g.p,d.E],data:{roleContains:["admin","user-viewer","user-admin"]}},{path:":id/change-password",loadChildren:()=>o.e(8973).then(o.bind(o,8973)).then(n=>n.ChangePasswordPageModule),canActivate:[g.p,d.E],data:{roleContains:["admin","user-viewer","user-admin"]}}];let R=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.Bz.forChild(w),m.Bz]}),n})(),z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.ez,a.u5,a.UX,y.Pc,R]}),n})()},8372:(A,C,o)=>{o.d(C,{b:()=>m});var h=o(4986),a=o(4482),y=o(5403);function m(g,d=h.z){return(0,a.e)((t,l)=>{let c=null,v=null,x=null;const b=()=>{if(c){c.unsubscribe(),c=null;const u=v;v=null,l.next(u)}};function P(){const u=x+g,U=d.now();if(U<u)return c=this.schedule(void 0,u-U),void l.add(c);b()}t.subscribe((0,y.x)(l,u=>{v=u,x=d.now(),c||(c=d.schedule(P,g),l.add(c))},()=>{b(),l.complete()},void 0,()=>{v=c=null}))})}}}]);
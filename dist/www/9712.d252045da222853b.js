"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9712],{9712:(J,p,o)=>{o.r(p),o.d(p,{GenerateCcrFormNo1aPageModule:()=>S});var f=o(9808),a=o(2382),h=o(8058),x=o(5503),u=o(7614),m=o(655),N=o(8675),C=o(8372),Z=o(8505),y=o(7391),U=o(2340),e=o(4893),v=o(8876),P=o(4465),F=o(7556),T=o(2294),b=o(9438),A=o(1110);function w(r,l){if(1&r&&(e.TgZ(0,"span",15),e._uU(1),e.ALo(2,"middleInitial"),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.lnq("",t.record.lastName||"-",", ",t.record.firstName||"-"," ",e.lcZ(2,3,t.record.middleName),"")}}function G(r,l){1&r&&(e.ynx(0),e._uU(1,"Print preview"),e.BQk())}function q(r,l){1&r&&(e.TgZ(0,"span",34),e._uU(1,"Loading preview"),e.qZA())}function Y(r,l){if(1&r&&e._UZ(0,"pdf-viewer",35),2&r){const t=e.oxw(2);e.Q6J("src",t.pdfUrl)("render-text",!0)("original-size",!1)}}function I(r,l){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",16)(2,"aside",17)(3,"form",18)(4,"div",19)(5,"div",20)(6,"label",21),e._uU(7,"Person who request"),e.qZA(),e._UZ(8,"input",22),e.TgZ(9,"div",23),e._uU(10,"This field is required"),e.qZA()(),e.TgZ(11,"div",20)(12,"label",24),e._uU(13,"Amount paid"),e.qZA(),e._UZ(14,"input",25),e.TgZ(15,"div",23),e._uU(16,"This field is required"),e.qZA()(),e.TgZ(17,"div",20)(18,"label",24),e._uU(19,"OR number"),e.qZA(),e._UZ(20,"input",26),e.TgZ(21,"div",23),e._uU(22,"This field is required"),e.qZA()(),e.TgZ(23,"div",20)(24,"label",24),e._uU(25,"Date paid"),e.qZA(),e._UZ(26,"input",27),e.TgZ(27,"div",23),e._uU(28,"This field is required"),e.qZA()(),e.TgZ(29,"div",20)(30,"label",24),e._uU(31,"Verifier"),e.qZA(),e._UZ(32,"input",28),e.TgZ(33,"div",23),e._uU(34,"This field is required"),e.qZA()(),e.TgZ(35,"div",20)(36,"label",24),e._uU(37,"Remarks"),e.qZA(),e._UZ(38,"textarea",29),e.TgZ(39,"div",23),e._uU(40,"This field is required"),e.qZA()()(),e.TgZ(41,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.printPreview())}),e.YNc(42,G,2,0,"ng-container",13),e.YNc(43,q,2,0,"ng-template",null,31,e.W1O),e.qZA()()(),e.TgZ(45,"aside",32),e.YNc(46,Y,1,3,"pdf-viewer",33),e.qZA()(),e.BQk()}if(2&r){const t=e.MAs(44),n=e.oxw();e.xp6(3),e.Q6J("formGroup",n.annotationForm),e.xp6(38),e.Q6J("disabled",n.loadingPreview||n.annotationForm.invalid),e.xp6(1),e.Q6J("ngIf",!n.loadingPreview)("ngIfElse",t),e.xp6(4),e.Q6J("ngIf",n.pdfUrl)}}function k(r,l){1&r&&e._uU(0,"Loading...")}const O=[{path:"",component:(()=>{class r{constructor(t,n,i,c,s,d,g,M,z){this.sqlService=t,this.toast=n,this.activatedRoute=i,this.authService=c,this.fb=s,this.sql=d,this.router=g,this.datePipe=M,this.birthReportService=z,this.annotationForm=this.fb.group({personWhoRequest:this.fb.nonNullable.control("",{validators:a.kI.required}),amountPaid:this.fb.nonNullable.control("",{validators:a.kI.required}),orNumber:this.fb.nonNullable.control("",{validators:a.kI.required}),datePaid:this.fb.nonNullable.control("",{validators:a.kI.required}),verifier:this.fb.nonNullable.control("",{validators:a.kI.required}),remarks:this.fb.nonNullable.control("",{validators:a.kI.required})}),this.loadingPreview=!1,this.skipLocationChange=U.N.production}ngOnInit(){return(0,m.mG)(this,void 0,void 0,function*(){const t=(new Date).toISOString().split("T")[0];this.annotationForm.controls.datePaid.setValue(t),yield this.initializeCurrentUser(),yield this.initializeRecord(),this.initializePreview()})}ngOnDestroy(){y.c.unsubscribe(this.annotationFormSubscription)}initializeCurrentUser(){return(0,m.mG)(this,void 0,void 0,function*(){try{const t=yield this.authService.getCurrentUserSnapshot();if(null===t)throw{code:"unauthenticated",message:"User is not currently logged in"};return this.currentUser=t,this.annotationForm.controls.verifier.setValue(t.firstName+" "+t.lastName),t}catch(t){return void console.error(t)}})}initializeRecord(){var t;return(0,m.mG)(this,void 0,void 0,function*(){try{const n=this.activatedRoute.snapshot.params.id,i=yield this.sqlService.table("birth").row(n).get(),c=i.attachments.filter(s=>s);return this.record=Object.assign(Object.assign({},i),{attachments:c}),this.annotationForm.controls.remarks.setValue(null!==(t=i.remarks)&&void 0!==t?t:""),i}catch(n){return void this.toast.presentError(n)}})}initializePreview(){this.annotationFormSubscription=this.annotationForm.valueChanges.pipe((0,N.O)(this.annotationForm.value),(0,C.b)(500),(0,Z.b)(t=>(0,m.mG)(this,void 0,void 0,function*(){var n,i;this.loadingPreview=!0;try{const c=null!==(n=this.record)&&void 0!==n?n:yield this.initializeRecord();if(!c)throw"internal";const s=null!==(i=this.currentUser)&&void 0!==i?i:yield this.initializeCurrentUser();if(!s)throw"internal";const d=Object.assign(Object.assign(Object.assign({},c),t),{showPreview:!1}),g=yield this.birthReportService.generateCcrFormNo1A(d,s);this.pdfUrl=g}catch(c){this.toast.presentError(c)}this.loadingPreview=!1}))).subscribe()}printPreview(){var t,n,i,c;return(0,m.mG)(this,void 0,void 0,function*(){try{const s=document.createElement("a");s.href=this.pdfUrl,s.target="__blank",s.click(),s.remove();const d=yield this.authService.getCurrentUserSnapshot();if(null===d)throw{code:"unauthenticated",message:"User is not currently logged in"};const g={datetime:this.datePipe.transform(new Date,"YYYY-MM-dd HH:mm:ss"),summary:`${d.username} generated CCR Form No. 1A report for ${null!==(c=null!==(n=null===(t=this.record)||void 0===t?void 0:t.registrationNumber)&&void 0!==n?n:null===(i=this.record)||void 0===i?void 0:i.lastName)&&void 0!==c?c:"birth"} record`,tags:["report",d.username,"birth"],ipAddress:"",user:d.username};yield this.sql.table("audit").add(g)}catch(s){this.toast.presentError(s)}this.router.navigate(["../"],{relativeTo:this.activatedRoute,skipLocationChange:!0})})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(v.a),e.Y36(P.k),e.Y36(u.gz),e.Y36(F.e),e.Y36(a.qu),e.Y36(v.a),e.Y36(u.F0),e.Y36(f.uU),e.Y36(T.h))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-view-birth"]],decls:19,vars:4,consts:[[1,"bg-light","border-bottom"],[1,"wrapper","px-xl-5","px-4"],[1,"d-flex","align-items-center","px-xl-5","pt-5"],[1,"mb-0","me-auto","text-dark","text-decoration-none","lh-1","fs-2-large","text-primary"],[1,"fs-2-large","text-primary","fw-bold"],[1,"px-xl-5","mt-4","mb-1"],["class","",4,"ngIf"],[1,"px-xl-5","pb-3","d-flex","justify-content-between","align-items-start"],["type","button","routerLink","../",1,"btn","btn-sm","btn-link","d-flex","align-items-center","text-decoration-none","text-info","ps-0",3,"skipLocationChange"],[1,"material-icons","fs-3","me-2"],[1,"fs-5"],[1,"content-wrapper","ps-xl-5","d-flex","flex-column"],[1,"ps-xl-5","ps-4","sd-section","flex-grow-1","d-flex","flex-column"],[4,"ngIf","ngIfElse"],["loadingState",""],[1,""],[1,"row","m-0","flex-grow-1"],[1,"form-aside","col-3","p-0","pb-5","pe-4"],["novalidate","",1,"mt-5",3,"formGroup"],[1,"row","g-3","mb-5"],[1,"col-12"],["for","firstName",1,"d-block","text-truncate","form-label","fs-5","mb-1"],["type","text","formControlName","personWhoRequest",1,"form-control","py-2","rounded-3"],[1,"invalid-feedback","mt-1","fs-5"],["for","lastName",1,"d-block","text-truncate","form-label","fs-5","mb-1"],["type","number","formControlName","amountPaid",1,"form-control","py-2","rounded-3"],["type","text","formControlName","orNumber",1,"form-control","py-2","rounded-3"],["type","date","formControlName","datePaid",1,"form-control","py-2","rounded-3"],["type","text","formControlName","verifier","readonly","",1,"form-control","py-2","rounded-3"],["type","text","formControlName","remarks",1,"form-control","py-2","rounded-3"],["type","submit",1,"rounded-3","px-4","py-2","btn","btn-info",3,"disabled","click"],["submitButtonLoadingState",""],[1,"iframe-aside","col-9"],["class","w-100 h-100",3,"src","render-text","original-size",4,"ngIf"],[1,"loading-dots"],[1,"w-100","h-100",3,"src","render-text","original-size"]],template:function(t,n){if(1&t&&(e.TgZ(0,"header",0)(1,"div",1)(2,"section",2)(3,"a",3)(4,"span",4),e._uU(5,"Generate CCR Form No. 1A"),e.qZA()()(),e.TgZ(6,"p",5),e.YNc(7,w,3,5,"span",6),e.qZA(),e.TgZ(8,"section",7)(9,"button",8)(10,"span",9),e._uU(11,"arrow_back"),e.qZA(),e.TgZ(12,"span",10),e._uU(13,"Back"),e.qZA()()()()(),e.TgZ(14,"main",11)(15,"main",12),e.YNc(16,I,47,5,"ng-container",13),e.qZA()(),e.YNc(17,k,1,0,"ng-template",null,14,e.W1O)),2&t){const i=e.MAs(18);e.xp6(7),e.Q6J("ngIf",n.record),e.xp6(2),e.Q6J("skipLocationChange",n.skipLocationChange),e.xp6(7),e.Q6J("ngIf",n.record)("ngIfElse",i)}},dependencies:[f.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,h.YI,u.rH,b.rQ,A.V],styles:[".content-wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 132px)}.content-wrapper[_ngcontent-%COMP%] > main[_ngcontent-%COMP%]{height:100%}.iframe-aside[_ngcontent-%COMP%]{background-color:gray}"]}),r})()}];let R=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[u.Bz.forChild(O),u.Bz]}),r})(),S=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[f.ez,a.u5,a.UX,h.Pc,R,x.D,b.xC]}),r})()}}]);